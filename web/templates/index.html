<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Room Booker - Office Meeting Room Reservation</title>
    <link rel="stylesheet" href="/static/css/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  <body>
    <!-- User Header -->
    <header class="ms-header">
      <div class="ms-header-content">
        <div class="ms-header-left">
          <div class="ms-app-icon">ðŸ“…</div>
          <h1 class="ms-app-title">Room Booker</h1>
        </div>
        <div class="ms-header-right">
          <div class="user-info" id="userInfo">
            <div class="user-avatar" id="userAvatar">ðŸ‘¤</div>
            <div class="user-details">
              <span class="user-name" id="userName">Loading...</span>
              <span class="user-role" id="userRole"></span>
            </div>
            <button class="btn btn-outline-secondary btn-sm" onclick="logout()">
              Sign out
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="ms-main-content">
      <div class="container-fluid">
        <!-- Office and Room Selection -->
        <div class="row mb-4">
          <div class="col-md-6">
            <div class="form-group">
              <label for="officeSelect" class="form-label">Select Office</label>
              <select
                class="form-select"
                id="officeSelect"
                onchange="loadRooms()"
              >
                <option value="">Loading offices...</option>
              </select>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="roomSelect" class="form-label">Select Room</label>
              <select
                class="form-select"
                id="roomSelect"
                onchange="loadCalendar()"
              >
                <option value="">Select office first</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Calendar -->
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">Room Schedule</h5>
              </div>
              <div class="card-body">
                <div id="calendar"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Booking Modal -->
    <div class="modal fade" id="bookingModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Book Room</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="bookingForm">
              <div class="mb-3">
                <label for="title" class="form-label">Meeting Title</label>
                <input type="text" class="form-control" id="title" required />
              </div>
              <div class="mb-3">
                <label for="startTime" class="form-label">Start Time</label>
                <input
                  type="datetime-local"
                  class="form-control"
                  id="startTime"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="endTime" class="form-label">End Time</label>
                <input
                  type="datetime-local"
                  class="form-control"
                  id="endTime"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="attendees" class="form-label"
                  >Attendees (optional)</label
                >
                <textarea
                  class="form-control"
                  id="attendees"
                  rows="3"
                  placeholder="Enter email addresses, one per line"
                ></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveBooking()"
            >
              Book Room
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Admin Panel (shown only for admins) -->
    <div id="adminPanel" class="admin-panel" style="display: none">
      <div class="admin-panel-grid">
        <aside class="admin-sidebar">
          <h4>Administration</h4>
          <ul class="admin-nav">
            <li>
              <button
                class="btn btn-sm btn-link"
                onclick="showAdminSection('offices')"
              >
                Offices
              </button>
            </li>
            <li>
              <button
                class="btn btn-sm btn-link"
                onclick="showAdminSection('floors')"
              >
                Floors
              </button>
            </li>
            <li>
              <button
                class="btn btn-sm btn-link"
                onclick="showAdminSection('rooms')"
              >
                Rooms
              </button>
            </li>
            <li>
              <button
                class="btn btn-sm btn-link"
                onclick="showAdminSection('users')"
              >
                Users
              </button>
            </li>
          </ul>
          <div class="mt-3">
            <button
              class="btn btn-outline-secondary btn-sm"
              onclick="toggleAdminPanel()"
            >
              Close
            </button>
          </div>
        </aside>

        <section class="admin-content">
          <div id="admin-offices" class="admin-section" style="display: none">
            <h5>Create Office</h5>
            <div class="mb-2">
              <input
                id="officeName"
                class="form-control"
                placeholder="Office name"
              />
            </div>
            <div class="mb-2">
              <input
                id="officeTZ"
                class="form-control"
                placeholder="Timezone (e.g. UTC)"
              />
            </div>
            <button class="btn btn-primary" onclick="createOffice()">
              Create Office
            </button>
          </div>

          <div id="admin-floors" class="admin-section" style="display: none">
            <h5>Create Floor</h5>
            <div class="mb-2">
              <input
                id="floorOfficeId"
                class="form-control"
                placeholder="Office ID"
              />
            </div>
            <div class="mb-2">
              <input
                id="floorNumber"
                type="number"
                class="form-control"
                placeholder="Floor number"
              />
            </div>
            <div class="mb-2">
              <input
                id="floorLabel"
                class="form-control"
                placeholder="Label (optional)"
              />
            </div>
            <button class="btn btn-primary" onclick="createFloor()">
              Create Floor
            </button>
          </div>

          <div id="admin-rooms" class="admin-section" style="display: none">
            <h5>Create Room</h5>
            <div class="mb-2">
              <input
                id="roomFloorId"
                class="form-control"
                placeholder="Floor ID"
              />
            </div>
            <div class="mb-2">
              <input
                id="roomName"
                class="form-control"
                placeholder="Room name"
              />
            </div>
            <div class="mb-2">
              <input
                id="roomCapacity"
                type="number"
                class="form-control"
                placeholder="Capacity"
              />
            </div>
            <div class="mb-2">
              <input
                id="roomEquipment"
                class="form-control"
                placeholder="Equipment (comma separated)"
              />
            </div>
            <button class="btn btn-primary" onclick="createRoom()">
              Create Room
            </button>
          </div>

          <div id="admin-users" class="admin-section" style="display: none">
            <h5>Users</h5>
            <button class="btn btn-outline-primary" onclick="loadUsersList()">
              Reload Users
            </button>
            <div id="usersList" class="mt-3"></div>
          </div>
        </section>
      </div>
    </div>

    <script src="/static/js/app.js"></script>
  </body>
</html>
